<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css}" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js}" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <link th:href="@{/css/reporte.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
    <div th:replace="~{vista/header :: miCabecera}"></div>
        
    <div class="container">
        <h1>Reporte de Ventas</h1>
        
        <form action="GenerarReporteServlet" method="POST" class="report-form">
            <div class="form-group">
                <label for="fechaDesde">Desde:</label>
                <input type="date" id="fechaDesde" name="fechaDesde" 
                       value="${fechaDesde != null ? fechaDesde : ''}" required>
            </div>
            
            <div class="form-group">
                <label for="fechaHasta">Hasta:</label>
                <input type="date" id="fechaHasta" name="fechaHasta" 
                       value="${fechaHasta != null ? fechaHasta : ''}" required>
            </div>
            
            <div class="form-group">
                <label for="categoria">Categorías:</label>
                <select id="categoria" name="categoria">
                    <option value="0">Todas las categorías</option>
                    <c:forEach var="cat" items="${categorias}">
                        <c:set var="parts" value="${fn:split(cat, '|')}" />
                        <c:set var="id" value="${parts[0]}" />
                        <c:set var="nombre" value="${parts[1]}" />
                        <c:set var="selectedId" value="${categoriaSeleccionada != null ? categoriaSeleccionada : 0}" />
                        <option value="${id}" <c:if test="${id == selectedId}">selected</c:if>>${nombre}</option>
                    </c:forEach>
                </select>
            </div>
            
            <div class="form-group">
                <label for="usuario">Usuarios:</label>
                <select id="usuario" name="usuario">
                    <option value="0">Todos los usuarios</option>
                    <c:forEach var="user" items="${usuarios}">
                        <c:set var="parts" value="${fn:split(user, '|')}" />
                        <c:set var="id" value="${parts[0]}" />
                        <c:set var="nombre" value="${parts[1]}" />
                        <c:set var="selectedId" value="${usuarioSeleccionado != null ? usuarioSeleccionado : 0}" />
                        <option value="${id}" <c:if test="${id == selectedId}">selected</c:if>>${nombre}</option>
                    </c:forEach>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Generar Reporte</button>
                <button type="reset" class="btn btn-secondary">Limpiar</button>
            </div>
        </form>
        
        <c:if test="${not empty reportes}">
            <div class="report-results">
                <h2>Resultados del Reporte</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <c:forEach var="nodo" items="${reportes}">
                            <tr>
                                <td>${nodo.usuario}</td>
                                <td>${nodo.producto}</td>
                                <td>${nodo.cantidad}</td>
                                <td>S/. ${fn:formatNumber(nodo.subtotal, '0.00')}</td>
                            </tr>
                        </c:forEach>
                    </tbody>
                </table>
            </div>
        </c:if>
        
        <c:if test="${not empty reportes and empty reportes}">
            <p class="no-results">No se encontraron resultados para los criterios seleccionados.</p>
        </c:if>
    </div>        
</body>
</html>
